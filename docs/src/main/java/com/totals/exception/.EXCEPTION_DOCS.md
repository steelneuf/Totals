# Exception Map Documentatie - BA Totalisatie Spring Boot Applicatie

## Overzicht van de Exception Map

De `exception/` map bevat alle exception handling klassen voor de BA Totalisatie Spring Boot applicatie. Deze map is verantwoordelijk voor het centraal afhandelen van alle fouten die optreden in de applicatie en het terugsturen van consistente error responses naar clients.

**Locatie**: `src/main/java/com/totals/exception/`

**Aantal bestanden**: 1 bestand

---

## Folder Structuur

```
exception/
├── GlobalExceptionHandler.java    # Centrale exception handler
└── .EXCEPTION_DOCS.md            # Deze documentatie
```

## Bestanden in de Exception Map

### GlobalExceptionHandler.java

**Doel**: Centrale exception handler die alle fouten in de applicatie afhandelt en consistente error responses terugstuurt.

**Package**: `com.totals.exception`

**Annotaties**:
- `@ControllerAdvice`: Spring annotatie die deze klasse markeert als een globale exception handler voor alle controllers

**Attributen**:
| Naam | Type | Beschrijving |
|------|------|--------------|
| `logger` | `Logger` | SLF4J logger instance voor error logging |

**Methoden**:

#### extractPath(WebRequest request)
```java
private String extractPath(WebRequest request)
```

**Parameters:**
- `request` (WebRequest): Spring WebRequest object met request informatie

**Functionaliteit:**
1. Extraheert de request path uit het WebRequest object
2. Verwijdert "uri=" prefix uit de description
3. Retourneert de schone path string

**Return Type**: `String`

#### handleResponseStatusException(ResponseStatusException ex, WebRequest request)
```java
@ExceptionHandler(ResponseStatusException.class)
public ResponseEntity<BaErrorResponse> handleResponseStatusException(ResponseStatusException ex, WebRequest request)
```

**Parameters:**
- `ex` (ResponseStatusException): De opgetreden ResponseStatusException
- `request` (WebRequest): WebRequest object voor path extractie

**Functionaliteit:**
1. Extraheert request path via `extractPath()`
2. Logt error op ERROR niveau
3. Creëert BaErrorResponse met status code en reason
4. Retourneert ResponseEntity met originele status code

**Return Type**: `ResponseEntity<BaErrorResponse>`

**HTTP Status**: Originele status code uit exception (404, 422, etc.)

#### handleIllegalArgumentException(IllegalArgumentException ex, WebRequest request)
```java
@ExceptionHandler(IllegalArgumentException.class)
public ResponseEntity<BaErrorResponse> handleIllegalArgumentException(IllegalArgumentException ex, WebRequest request)
```

**Parameters:**
- `ex` (IllegalArgumentException): De opgetreden IllegalArgumentException
- `request` (WebRequest): WebRequest object voor path extractie

**Functionaliteit:**
1. Extraheert request path via `extractPath()`
2. Logt warning op WARN niveau
3. Creëert BaErrorResponse met 400 Bad Request status
4. Voegt "Ongeldige parameter:" prefix toe aan error message

**Return Type**: `ResponseEntity<BaErrorResponse>`

**HTTP Status**: 400 Bad Request

#### handleDataAccessException(DataAccessException ex, WebRequest request)
```java
@ExceptionHandler(DataAccessException.class)
public ResponseEntity<BaErrorResponse> handleDataAccessException(DataAccessException ex, WebRequest request)
```

**Parameters:**
- `ex` (DataAccessException): De opgetreden DataAccessException
- `request` (WebRequest): WebRequest object voor path extractie

**Functionaliteit:**
1. Extraheert request path via `extractPath()`
2. Logt error op ERROR niveau
3. Creëert BaErrorResponse met 503 Service Unavailable status
4. Gebruikt vaste message over database onbeschikbaarheid

**Return Type**: `ResponseEntity<BaErrorResponse>`

**HTTP Status**: 503 Service Unavailable


#### handleGenericException(Exception ex, WebRequest request)
```java
@ExceptionHandler(Exception.class)
public ResponseEntity<BaErrorResponse> handleGenericException(Exception ex, WebRequest request)
```

**Parameters:**
- `ex` (Exception): De opgetreden Exception (catch-all)
- `request` (WebRequest): WebRequest object voor path extractie

**Functionaliteit:**
1. Extraheert request path via `extractPath()`
2. Logt error op ERROR niveau met volledige stack trace
3. Creëert BaErrorResponse met 500 Internal Server Error status
4. Gebruikt generieke message voor onverwachte fouten

**Return Type**: `ResponseEntity<BaErrorResponse>`

**HTTP Status**: 500 Internal Server Error

**Dependencies:**
- `BaErrorResponse`: Voor error response formatting
- `Logger`: Voor error logging
- Spring Web classes: Voor exception handling

**Gebruik in Applicatie**: Wordt automatisch gebruikt door Spring voor alle unhandled exceptions in controllers.

---

## Samenwerking tussen Componenten

De GlobalExceptionHandler werkt samen met:

### Controllers
- Alle REST controllers gebruiken deze handler automatisch
- Geen expliciete try-catch blokken nodig in controllers
- Consistente error responses voor alle endpoints

### BaErrorResponse DTO
- Gebruikt de factory method `BaErrorResponse.of()`
- Zorgt voor consistente error response structuur
- Automatische timestamp toevoeging

### Logging System
- Integreert met SLF4J logging
- Verschillende log levels per exception type
- Stack trace logging voor onverwachte errors

## Exception Handling Flow

```
Exception Occurs in Controller
    ↓
Spring Framework Detection
    ↓
GlobalExceptionHandler Method
    ↓
Path Extraction + Logging
    ↓
BaErrorResponse Creation
    ↓
HTTP Response to Client
```

## HTTP Status Code Mapping

| Exception Type | HTTP Status | Log Level | Description |
|----------------|-------------|-----------|-------------|
| ResponseStatusException | Origineel | ERROR | 404, 422, etc. |
| IllegalArgumentException | 400 | ERROR | Input validatie fouten |
| DataAccessException | 503 | ERROR | Database problemen |
| Exception (catch-all) | 500 | ERROR | Onverwachte fouten |

## Error Response Format

Alle error responses volgen het BaErrorResponse format:

```json
{
  "timestamp": "2024-01-15T10:30:45.123",
  "status": 400,
  "error": "Bad Request",
  "message": "Ongeldige parameter: [details]",
  "path": "/api/v1/ba/ABC123/calculate-totals"
}
```

## Best Practices Geïmplementeerd

1. **Centralisatie**: Alle exception handling op één plek
2. **Consistentie**: Uniforme error response format
3. **Logging**: Uitgebreide logging voor debugging
4. **Graceful Degradation**: Geen crashes, altijd response
5. **Security**: Geen gevoelige informatie in error messages
6. **Monitoring**: Verschillende log levels voor verschillende severity levels

## Troubleshooting

### Veelvoorkomende Problemen

1. **Exception niet afgehandeld**: Controleer of @ControllerAdvice correct is geconfigureerd
2. **Verkeerde status code**: Controleer exception handler mapping
3. **Geen logging**: Controleer SLF4J configuratie
4. **Path extraction fout**: Controleer WebRequest object

### Debug Tips

- Gebruik logback configuratie voor detailed logging
- Test verschillende exception types
- Controleer BaErrorResponse factory method
- Valideer HTTP status codes in browser developer tools
