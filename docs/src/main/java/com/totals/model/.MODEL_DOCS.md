# Model Map Documentatie - BA Totalisatie Spring Boot Applicatie

## Overzicht van de Model Map

De `model/` map bevat alle JPA entity klassen voor de BA Totalisatie Spring Boot applicatie. Deze entities representeren de database tabellen en bevatten de data modellen voor BA records en berekende totalen.

**Locatie**: `src/main/java/com/totals/model/`

**Aantal bestanden**: 2 bestanden

---

## Folder Structuur

```
model/
├── BaRecord.java         # JPA entity voor BA records
├── BaTotalRecord.java    # JPA entity voor berekende totalen
└── .MODEL_DOCS.md       # Deze documentatie
```

## Bestanden in de Model Map

### BaRecord.java

**Doel**: JPA entity die de `ba_records` database tabel representeert en individuele BA records opslaat.

**Package**: `com.totals.model`

**Annotaties**:
- `@Entity`: JPA annotatie die deze klasse markeert als een persistente entity
- `@Table(name = "ba_records")`: Specificeert de database tabel naam
- `@Id`: Markeert het primary key veld
- `@GeneratedValue(strategy = GenerationType.IDENTITY)`: Auto-increment primary key
- `@Column(name = "kenmerk")`: Database kolom mapping voor kenmerk
- `@NotBlank(message = "Kenmerk mag niet leeg zijn")`: Validatie constraint
- `@NotNull(message = "Kenmerk is verplicht")`: Validatie constraint

**Attributen**:
| Naam | Type | Database Kolom | Validatie | Beschrijving |
|------|------|----------------|-----------|--------------|
| `id` | `Long` | `id` | - | Primary key (auto-generated) |
| `kenmerk` | `String` | `kenmerk` | @NotBlank, @NotNull | Unieke identifier voor groepering |
| `cijfer1` | `Double` | `cijfer1` | @NotNull | Eerste numerieke waarde |
| `cijfer2` | `Double` | `cijfer2` | @NotNull | Tweede numerieke waarde |
| `cijfer3` | `Double` | `cijfer3` | @NotNull | Derde numerieke waarde |
| `cijfer4` | `Double` | `cijfer4` | @NotNull | Vierde numerieke waarde |
| `cijfer5` | `Double` | `cijfer5` | @NotNull | Vijfde numerieke waarde |
| `cijfer6` | `Double` | `cijfer6` | @NotNull | Zesde numerieke waarde |

**Methoden**:

#### Getter/Setter Pairs
```java
public Long getId() { return id; }
public void setId(Long id) { this.id = id; }

public String getKenmerk() { return kenmerk; }
public void setKenmerk(String kenmerk) { this.kenmerk = kenmerk; }

public Double getCijfer1() { return cijfer1; }
public void setCijfer1(Double cijfer1) { this.cijfer1 = cijfer1; }

public Double getCijfer2() { return cijfer2; }
public void setCijfer2(Double cijfer2) { this.cijfer2 = cijfer2; }

public Double getCijfer3() { return cijfer3; }
public void setCijfer3(Double cijfer3) { this.cijfer3 = cijfer3; }

public Double getCijfer4() { return cijfer4; }
public void setCijfer4(Double cijfer4) { this.cijfer4 = cijfer4; }

public Double getCijfer5() { return cijfer5; }
public void setCijfer5(Double cijfer5) { this.cijfer5 = cijfer5; }

public Double getCijfer6() { return cijfer6; }
public void setCijfer6(Double cijfer6) { this.cijfer6 = cijfer6; }
```

**Functionaliteit:**
- Standard JavaBean pattern met getter/setter pairs
- JPA persistence via Hibernate
- Bean validation via Jakarta Validation API

**Dependencies:**
- `jakarta.persistence.*`: JPA annotations
- `jakarta.validation.constraints.*`: Validation constraints

**Gebruik in Applicatie**: Wordt gebruikt door `BaRecordRepository` voor database operaties en door `BaService` voor data aggregatie.

---

### BaTotalRecord.java

**Doel**: JPA entity die de `ba_totals` database tabel representeert en berekende BA totalen opslaat.

**Package**: `com.totals.model`

**Annotaties**:
- `@Entity`: JPA annotatie die deze klasse markeert als een persistente entity
- `@Table(name = "ba_totals")`: Specificeert de database tabel naam
- `@Id`: Markeert het primary key veld
- `@GeneratedValue(strategy = GenerationType.IDENTITY)`: Auto-increment primary key
- `@Column(name = "kenmerk")`: Database kolom mapping voor kenmerk
- `@NotBlank(message = "Kenmerk mag niet leeg zijn")`: Validatie constraint
- `@NotNull(message = "Kenmerk is verplicht")`: Validatie constraint
- `@JsonIgnore`: Exclude van JSON serialisatie

**Attributen**:
| Naam | Type | Database Kolom | Validatie | Beschrijving |
|------|------|----------------|-----------|--------------|
| `id` | `Long` | `id` | - | Primary key (auto-generated) |
| `kenmerk` | `String` | `kenmerk` | @NotBlank, @NotNull | Unieke identifier voor groepering |
| `totaal1` | `Double` | `totaal1` | @NotNull | Eerste berekende totaal |
| `totaal2` | `Double` | `totaal2` | @NotNull | Tweede berekende totaal |
| `totaal3` | `Double` | `totaal3` | @NotNull | Derde berekende totaal |
| `totaal4` | `Double` | `totaal4` | @NotNull | Vierde berekende totaal |
| `totaal5` | `Double` | `totaal5` | @NotNull | Vijfde berekende totaal |
| `requestTimestamp` | `Long` | `request_timestamp` | - | Request timestamp (JSON ignored) |

**Methoden**:

#### Constructors
```java
// Default constructor
public BaTotalRecord() {}

// Copy constructor
public BaTotalRecord(String kenmerk, BaTotalRecord source) {
    this.kenmerk = kenmerk;
    this.totaal1 = source.totaal1;
    this.totaal2 = source.totaal2;
    this.totaal3 = source.totaal3;
    this.totaal4 = source.totaal4;
    this.totaal5 = source.totaal5;
}
```

#### Getter/Setter Pairs
```java
public Long getId() { return id; }
public void setId(Long id) { this.id = id; }

public String getKenmerk() { return kenmerk; }
public void setKenmerk(String kenmerk) { this.kenmerk = kenmerk; }

public Double getTotaal1() { return totaal1; }
public void setTotaal1(Double totaal1) { this.totaal1 = totaal1; }

public Double getTotaal2() { return totaal2; }
public void setTotaal2(Double totaal2) { this.totaal2 = totaal2; }

public Double getTotaal3() { return totaal3; }
public void setTotaal3(Double totaal3) { this.totaal3 = totaal3; }

public Double getTotaal4() { return totaal4; }
public void setTotaal4(Double totaal4) { this.totaal4 = totaal4; }

public Double getTotaal5() { return totaal5; }
public void setTotaal5(Double totaal5) { this.totaal5 = totaal5; }

public Long getRequestTimestamp() { return requestTimestamp; }
public void setRequestTimestamp(Long requestTimestamp) { this.requestTimestamp = requestTimestamp; }
```

**Functionaliteit:**
- Standard JavaBean pattern met getter/setter pairs
- JPA persistence via Hibernate
- Bean validation via Jakarta Validation API
- JSON serialisatie uitsluiting voor timestamp

**Dependencies:**
- `jakarta.persistence.*`: JPA annotations
- `jakarta.validation.constraints.*`: Validation constraints
- `com.fasterxml.jackson.annotation.*`: JSON annotations

**Gebruik in Applicatie**: Wordt gebruikt door `BaTotalRepository` voor database operaties en door `BaService` voor het opslaan van berekende totalen.

---

## Samenwerking tussen Componenten

### Database Schema Relatie
```
ba_records (BaRecord)
    ↓ (via kenmerk)
ba_totals (BaTotalRecord)
```

### Data Flow
1. **Input**: `BaRecord` entities worden opgeslagen via `BaRecordRepository`
2. **Aggregatie**: `BaService` haalt `BaRecord` data op en aggregeert per kenmerk
3. **Berekening**: `BaCalculator` voert berekeningen uit op geaggregeerde data
4. **Output**: `BaTotalRecord` entities worden opgeslagen via `BaTotalRepository`

### Repository Integration
- `BaRecordRepository`: CRUD operaties op `BaRecord` entities
- `BaTotalRepository`: CRUD operaties op `BaTotalRecord` entities
- Custom queries voor aggregatie en updates

## Database Schema Details

### ba_records Tabel
```sql
CREATE TABLE ba_records (
    id BIGSERIAL PRIMARY KEY,
    kenmerk VARCHAR(255) NOT NULL,
    cijfer1 DOUBLE PRECISION NOT NULL,
    cijfer2 DOUBLE PRECISION NOT NULL,
    cijfer3 DOUBLE PRECISION NOT NULL,
    cijfer4 DOUBLE PRECISION NOT NULL,
    cijfer5 DOUBLE PRECISION NOT NULL,
    cijfer6 DOUBLE PRECISION NOT NULL
);
```

### ba_totals Tabel
```sql
CREATE TABLE ba_totals (
    id BIGSERIAL PRIMARY KEY,
    kenmerk VARCHAR(255) NOT NULL,
    totaal1 DOUBLE PRECISION NOT NULL,
    totaal2 DOUBLE PRECISION NOT NULL,
    totaal3 DOUBLE PRECISION NOT NULL,
    totaal4 DOUBLE PRECISION NOT NULL,
    totaal5 DOUBLE PRECISION NOT NULL,
    request_timestamp BIGINT
);
```

## Validatie Constraints

### BaRecord Validatie
- **kenmerk**: Niet leeg en niet null (business identifier)
- **cijfer1-6**: Niet null (alle numerieke waarden verplicht)

### BaTotalRecord Validatie
- **kenmerk**: Niet leeg en niet null (business identifier)
- **totaal1-5**: Niet null (alle berekende totalen verplicht)
- **requestTimestamp**: Geen validatie (optioneel, intern gebruik)

## JPA/Hibernate Configuratie

### Entity Mapping
- **Table Names**: Expliciet gedefinieerd via `@Table`
- **Column Names**: Expliciet gedefinieerd via `@Column`
- **Primary Keys**: Auto-increment via `GenerationType.IDENTITY`
- **Validation**: Bean validation via Jakarta Validation API

### Performance Overwegingen
- **Lazy Loading**: Default JPA lazy loading voor associaties
- **Batch Processing**: Mogelijk via repository custom queries
- **Indexing**: Kenmerk kolommen zijn geïndexeerd voor snelle lookups

## Best Practices Geïmplementeerd

1. **Immutability**: Entities zijn mutable maar met controlled access via setters
2. **Validation**: Bean validation op entity niveau
3. **Naming**: Consistente naming tussen Java en database
4. **Separation**: Duidelijke scheiding tussen input (BaRecord) en output (BaTotalRecord)
5. **JSON Control**: Expliciete JSON serialisatie controle waar nodig

## Troubleshooting

### Veelvoorkomende Problemen

1. **Validation Errors**: Controleer @NotNull en @NotBlank constraints
2. **Database Mapping**: Controleer @Table en @Column namen
3. **JSON Serialisatie**: Controleer @JsonIgnore annotaties
4. **Primary Key Issues**: Controleer @GeneratedValue configuratie

### Debug Tips

- Gebruik Hibernate SQL logging voor query debugging
- Valideer entity mapping via JPA console
- Test validation constraints met verschillende data
- Controleer database schema tegen entity definities
