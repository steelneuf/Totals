# Resources Map Documentatie - BA Totalisatie Spring Boot Applicatie

## Overzicht van de Resources Map

De `resources/` map bevat alle configuratiebestanden voor de BA Totalisatie Spring Boot applicatie. Deze bestanden definiëren de runtime configuratie, logging setup en environment-specifieke instellingen.

**Locatie**: `src/main/resources/`

**Aantal bestanden**: 2 bestanden

---

## Folder Structuur

```
resources/
├── application.properties    # Spring Boot configuratie
├── logback-spring.xml       # Logback logging configuratie
└── .RESOURCES_DOCS.md      # Deze documentatie
```

## Bestanden in de Resources Map

### application.properties

**Doel**: Centrale Spring Boot configuratie met alle properties voor database, logging, API en business logic.

**Package**: `src/main/resources`

**Configuratie Secties**:

#### 1. Database Configuratie
```properties
# Database verbinding
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/ba_totals_db}
spring.datasource.username=${DB_USERNAME:ba_user}
spring.datasource.password=${DB_PASSWORD:ba_pass}
```

**Properties**:
| Property | Environment Variable | Default Waarde | Beschrijving |
|----------|---------------------|----------------|--------------|
| `spring.datasource.url` | `DB_URL` | `jdbc:postgresql://localhost:5432/ba_totals_db` | PostgreSQL database URL |
| `spring.datasource.username` | `DB_USERNAME` | `ba_user` | Database username |
| `spring.datasource.password` | `DB_PASSWORD` | `ba_pass` | Database password |

#### 2. Connection Pool Configuratie
```properties
# Database connection pool size
spring.datasource.hikari.maximum-pool-size=1
spring.datasource.hikari.minimum-idle=1
```

**Properties**:
| Property | Waarde | Beschrijving |
|----------|--------|--------------|
| `spring.datasource.hikari.maximum-pool-size` | `1` | Single connection (matcht single-threaded) |
| `spring.datasource.hikari.minimum-idle` | `1` | Minimum idle connections |

#### 3. Tomcat Thread Configuratie
```properties
# Threading mode
server.tomcat.threads.max=1
server.tomcat.threads.min-spare=1
```

**Properties**:
| Property | Waarde | Beschrijving |
|----------|--------|--------------|
| `server.tomcat.threads.max` | `1` | Single-threaded (voorspelbaar, eenvoudig) |
| `server.tomcat.threads.min-spare` | `1` | Minimum spare threads |

#### 4. JPA/Hibernate Configuratie
```properties
# Schema validatie (geen wijzigingen)
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.open-in-view=false
```

**Properties**:
| Property | Waarde | Beschrijving |
|----------|--------|--------------|
| `spring.jpa.hibernate.ddl-auto` | `validate` | Geen schema wijzigingen |
| `spring.jpa.open-in-view` | `false` | Performance optimalisatie |

#### 5. Logging Configuratie
```properties
# Log path (configureerbaar via environment variable)
logging.path=${LOG_PATH:./logs}
logging.level.root=${LOG_LEVEL:INFO}

# Log file configuratie
logging.file.application.max-size=${LOG_APP_MAX_SIZE:10MB}
logging.file.application.max-history=${LOG_APP_MAX_HISTORY:30}
```

**Properties**:
| Property | Environment Variable | Default Waarde | Beschrijving |
|----------|---------------------|----------------|--------------|
| `logging.path` | `LOG_PATH` | `./logs` | Log directory |
| `logging.level.root` | `LOG_LEVEL` | `INFO` | Root log level |
| `logging.file.application.max-size` | `LOG_APP_MAX_SIZE` | `10MB` | Max file size |
| `logging.file.application.max-history` | `LOG_APP_MAX_HISTORY` | `30` | Max history (dagen) |


#### 6. API Configuratie
```properties
# API Versioning
api.version=v1
```

**Properties**:
| Property | Waarde | Beschrijving |
|----------|--------|--------------|
| `api.version` | `v1` | API versie voor endpoints |

#### 7. Calculation Log Configuratie
```properties
# Calculation log configuratie
logging.calculation.filename=ba-calc.log
```

**Properties**:
| Property | Waarde | Beschrijving |
|----------|--------|--------------|
| `logging.calculation.filename` | `ba-calc.log` | Calculation log filename |

#### 8. OpenAPI/Swagger Configuratie
```properties
# OpenAPI documentatie configuratie
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha
springdoc.swagger-ui.tryItOutEnabled=true
```

**Properties**:
| Property | Waarde | Beschrijving |
|----------|--------|--------------|
| `springdoc.api-docs.path` | `/v3/api-docs` | OpenAPI JSON endpoint |
| `springdoc.swagger-ui.path` | `/swagger-ui.html` | Swagger UI endpoint |
| `springdoc.swagger-ui.enabled` | `true` | Swagger UI enabled |
| `springdoc.swagger-ui.operationsSorter` | `method` | Sort operations by HTTP method |
| `springdoc.swagger-ui.tagsSorter` | `alpha` | Sort tags alphabetically |
| `springdoc.swagger-ui.tryItOutEnabled` | `true` | Enable try-it-out functionality |

**Environment Variables Support**:
- `DB_URL`, `DB_USERNAME`, `DB_PASSWORD`: Database configuratie
- `LOG_PATH`, `LOG_LEVEL`: Logging configuratie
- `LOG_APP_MAX_SIZE`, `LOG_APP_MAX_HISTORY`: Log file configuratie

---

### logback-spring.xml

**Doel**: Geavanceerde Logback logging configuratie met JSON output, log rotation en separate appenders.

**Package**: `src/main/resources`

**Configuratie Properties**:
```xml
<springProperty scope="context" name="LOG_PATH" source="logging.path" defaultValue="./logs"/>
<springProperty scope="context" name="LOG_LEVEL" source="logging.level.root" defaultValue="INFO"/>
<springProperty scope="context" name="LOG_APP_MAX_SIZE" source="logging.file.application.max-size" defaultValue="10MB"/>
<springProperty scope="context" name="LOG_APP_MAX_HISTORY" source="logging.file.application.max-history" defaultValue="30"/>
```

**Spring Properties Binding**:
| Property | Source | Default | Beschrijving |
|----------|--------|---------|--------------|
| `LOG_PATH` | `logging.path` | `./logs` | Log directory |
| `LOG_LEVEL` | `logging.level.root` | `INFO` | Root log level |
| `LOG_APP_MAX_SIZE` | `logging.file.application.max-size` | `10MB` | Max file size |
| `LOG_APP_MAX_HISTORY` | `logging.file.application.max-history` | `30` | Max history |

#### Appenders

##### APPLICATION_FILE Appender
```xml
<appender name="APPLICATION_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_PATH}/app.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
        <fileNamePattern>${LOG_PATH}/app.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
        <maxFileSize>${LOG_APP_MAX_SIZE}</maxFileSize>
        <maxHistory>${LOG_APP_MAX_HISTORY}</maxHistory>
    </rollingPolicy>
    <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>
</appender>
```

**Configuratie**:
- **Type**: `RollingFileAppender`
- **File**: `${LOG_PATH}/app.log`
- **Rolling Policy**: `SizeAndTimeBasedRollingPolicy`
- **Pattern**: `${LOG_PATH}/app.%d{yyyy-MM-dd}.%i.log`
- **Max Size**: `${LOG_APP_MAX_SIZE}`
- **Max History**: `${LOG_APP_MAX_HISTORY}`
- **Encoder**: `LogstashEncoder` (JSON format)

##### CALCULATION_FILE Appender
```xml
<appender name="CALCULATION_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_PATH}/ba-calc.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
        <fileNamePattern>${LOG_PATH}/ba-calc.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
        <maxFileSize>${LOG_APP_MAX_SIZE}</maxFileSize>
        <maxHistory>${LOG_APP_MAX_HISTORY}</maxHistory>
    </rollingPolicy>
    <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>
</appender>
```

**Configuratie**:
- **Type**: `RollingFileAppender`
- **File**: `${LOG_PATH}/ba-calc.log`
- **Rolling Policy**: `SizeAndTimeBasedRollingPolicy`
- **Pattern**: `${LOG_PATH}/ba-calc.%d{yyyy-MM-dd}.%i.log`
- **Max Size**: `${LOG_APP_MAX_SIZE}`
- **Max History**: `${LOG_APP_MAX_HISTORY}`
- **Encoder**: `LogstashEncoder` (JSON format)

#### Loggers

##### BA Services Logger
```xml
<logger name="com.totals.service.ba" level="INFO" additivity="false">
    <appender-ref ref="CALCULATION_FILE"/>
</logger>
```

**Configuratie**:
- **Name**: `com.totals.service.ba`
- **Level**: `INFO`
- **Additivity**: `false`
- **Appender**: `CALCULATION_FILE` (alleen naar calculation log)

##### Exception Handler Logger
```xml
<logger name="com.totals.exception.GlobalExceptionHandler" level="INFO" additivity="false">
    <appender-ref ref="CALCULATION_FILE"/>
    <appender-ref ref="APPLICATION_FILE"/>
</logger>
```

**Configuratie**:
- **Name**: `com.totals.exception.GlobalExceptionHandler`
- **Level**: `INFO`
- **Additivity**: `false`
- **Appenders**: `CALCULATION_FILE` + `APPLICATION_FILE`

##### Root Logger
```xml
<root level="${LOG_LEVEL}">
    <appender-ref ref="APPLICATION_FILE"/>
</root>
```

**Configuratie**:
- **Level**: `${LOG_LEVEL}`
- **Appender**: `APPLICATION_FILE`

**Features**:
- **JSON Logging**: LogstashEncoder voor structured logging
- **Log Rotation**: Size en time based rolling
- **Separate Logs**: BA calculations in aparte log file
- **Configurable**: Paths en levels via Spring properties

---

## Samenwerking tussen Componenten

### Configuration Flow
```
Environment Variables
    ↓
application.properties
    ↓
Spring Boot Application
    ↓
logback-spring.xml
    ↓
Log Files
```

### Property Resolution
1. **Environment Variables**: Hoogste prioriteit
2. **application.properties**: Default waarden
3. **Spring Boot Defaults**: Fallback waarden

### Logging Flow
```
Application Code
    ↓
Logger (SLF4J)
    ↓
Logback Configuration
    ↓
Appenders (APPLICATION_FILE, CALCULATION_FILE)
    ↓
Log Files (app.log, ba-calc.log)
```

## Environment Variable Overrides

### Database Configuratie
```bash
export DB_URL="jdbc:postgresql://prod-server:5432/ba_totals"
export DB_USERNAME="prod_user"
export DB_PASSWORD="secure_password"
```

### Logging Configuratie
```bash
export LOG_PATH="/var/log/ba-totals"
export LOG_LEVEL="DEBUG"
export LOG_APP_MAX_SIZE="50MB"
export LOG_APP_MAX_HISTORY="60"
```


## Log File Management

### File Rotation Strategy
- **Size Based**: Files worden geroteerd bij max size
- **Time Based**: Files worden geroteerd dagelijks
- **Pattern**: `filename.YYYY-MM-DD.i.log`
- **Retention**: Max history (dagen) configurable

### Log File Locations
- **Application Logs**: `${LOG_PATH}/app.log`
- **Calculation Logs**: `${LOG_PATH}/ba-calc.log`
- **Default Path**: `./logs/`

## Performance Overwegingen

### Single-Threaded Configuratie
- **Tomcat Threads**: Max 1 thread
- **Connection Pool**: Max 1 connection
- **Predictable**: Voorspelbare performance
- **Simple**: Eenvoudige debugging

### Logging Performance
- **JSON Output**: Structured logging voor monitoring
- **File Rotation**: Voorkomt grote log files
- **Separate Logs**: BA calculations apart voor filtering

## Security Overwegingen

### Database Security
- **Environment Variables**: Passwords niet in code
- **Connection Pool**: Beperkte connections
- **Schema Validation**: Geen automatische schema wijzigingen

### Logging Security
- **Structured Logs**: JSON format voor monitoring
- **Separate Logs**: BA data apart van system logs
- **Configurable Paths**: Logs kunnen buiten applicatie directory

## Best Practices Geïmplementeerd

1. **Environment Variables**: Sensitive data via environment
2. **Property Hierarchie**: Environment > properties > defaults
3. **Structured Logging**: JSON format voor monitoring
4. **Log Separation**: Business logs apart van system logs
5. **Configurable**: Alle belangrijke waarden configureerbaar
6. **Single-Threaded**: Voorspelbare performance
7. **API Documentation**: OpenAPI/Swagger integratie

## Troubleshooting

### Veelvoorkomende Problemen

1. **Database Connection**: Controleer DB_URL, DB_USERNAME, DB_PASSWORD
2. **Log Files**: Controleer LOG_PATH en file permissions
3. **Property Loading**: Controleer environment variable syntax
4. **Log Rotation**: Controleer disk space en file permissions

### Debug Tips

- Gebruik Spring Boot Actuator voor configuratie inspectie
- Controleer logback configuratie via logging debug
- Valideer environment variables via application startup logs
- Test database connectiviteit via health endpoint
